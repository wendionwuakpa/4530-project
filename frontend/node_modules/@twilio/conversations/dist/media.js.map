{"version":3,"file":"media.js","sources":["../src/media.ts"],"sourcesContent":["import {\n  McsClient,\n  McsMedia,\n  MediaCategory as McsMediaCategory,\n  CancellablePromise,\n} from \"@twilio/mcs-client\";\n\n/**\n * Category of media. Possible values are as follows:\n * * `'media'`\n * * `'body'`\n * * `'history'`\n */\ntype MediaCategory = McsMediaCategory;\n\ninterface MediaState {\n  sid: string;\n  category: MediaCategory;\n  filename: string | null;\n  contentType: string;\n  size: number;\n}\n\ninterface MediaServices {\n  mcsClient: McsClient;\n}\n\n/**\n * Represents a media information for a message in a conversation.\n */\nclass Media {\n  private state: MediaState;\n  private services: MediaServices;\n  private mcsMedia: McsMedia | null = null;\n\n  /**\n   * @internal\n   */\n  constructor(data: MediaState | McsMedia, services: MediaServices) {\n    this.services = services;\n\n    if (data instanceof McsMedia) {\n      this.mcsMedia = data as McsMedia;\n    }\n\n    this.state = {\n      sid: data.sid,\n      category: data.category,\n      filename: data.filename,\n      contentType: data.contentType,\n      size: data.size,\n    };\n  }\n\n  /**\n   * Server-assigned unique identifier for the media.\n   */\n  public get sid(): string {\n    return this.state.sid;\n  }\n\n  /**\n   * File name. Null if absent.\n   */\n  public get filename(): string | null {\n    return this.state.filename;\n  }\n\n  /**\n   * Content type of the media.\n   */\n  public get contentType(): string {\n    return this.state.contentType;\n  }\n\n  /**\n   * Size of the media in bytes.\n   */\n  public get size(): number {\n    return this.state.size;\n  }\n\n  /**\n   * Media category, can be one of the {@link MediaCategory} values.\n   */\n  public get category(): MediaCategory {\n    return this.state.category;\n  }\n\n  /**\n   * Returns the direct content URL for the media.\n   *\n   * This URL is impermanent, it will expire in several minutes and cannot be cached.\n   * If the URL becomes expired, you need to request a new one.\n   * Each call to this function produces a new temporary URL.\n   */\n  public getContentTemporaryUrl(): CancellablePromise<string | null> {\n    return new CancellablePromise(async (resolve, reject, onCancel) => {\n      const fetchMediaRequest = this._fetchMcsMedia();\n      let contentUrlRequest = this.mcsMedia?.getContentUrl();\n\n      onCancel(() => {\n        fetchMediaRequest.cancel();\n        if (contentUrlRequest) {\n          contentUrlRequest.cancel();\n        }\n      });\n\n      try {\n        if (!this.mcsMedia) {\n          const mcsMedia = await fetchMediaRequest;\n          contentUrlRequest = mcsMedia.getContentUrl();\n        }\n        resolve(contentUrlRequest ? await contentUrlRequest : null);\n      } catch (e) {\n        reject(e);\n      }\n    });\n  }\n\n  private _fetchMcsMedia(): CancellablePromise<McsMedia> {\n    return new CancellablePromise(async (resolve, reject, onCancel) => {\n      const request = this.services.mcsClient.get(this.state.sid);\n      if (this.services.mcsClient) {\n        onCancel(() => request.cancel());\n\n        try {\n          this.mcsMedia = await request;\n          resolve(this.mcsMedia);\n        } catch (e) {\n          reject(e);\n        }\n        return;\n      }\n\n      reject(new Error(\"Media Content Service is unavailable\"));\n    });\n  }\n}\n\nexport { Media, MediaState, MediaServices, MediaCategory };\n"],"names":["McsMedia","CancellablePromise"],"mappings":"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"}