{"version":3,"file":"content-client.js","sources":["../src/content-client.ts"],"sourcesContent":["import { CommandExecutor } from \"./command-executor\";\nimport { ContentTemplate } from \"./content-template\";\nimport { ContentTemplatesResponse } from \"./interfaces/commands/content-templates-response\";\nimport { UriBuilder } from \"./util\";\n\ntype ContentClientServices = {\n  commandExecutor: CommandExecutor;\n};\n\nclass ContentClient {\n  private _cachedTemplates: Readonly<ContentTemplate[]> | null = null;\n\n  public constructor(\n    private readonly _services: ContentClientServices,\n    private readonly _pageSize: number = 100,\n    private readonly _cacheTtlMs: number = 5_000\n  ) {}\n\n  public async getContentTemplates(): Promise<Readonly<ContentTemplate[]>> {\n    if (this._cachedTemplates !== null) {\n      return this._cachedTemplates;\n    }\n\n    let [templatesPage, nextToken] = await this._fetchContentTemplates();\n    let templates = templatesPage;\n\n    while (nextToken !== null) {\n      [templatesPage, nextToken] = await this._fetchContentTemplates(nextToken);\n      templates = [...templates, ...templatesPage];\n    }\n\n    this._cachedTemplates = Object.freeze(templates);\n\n    setTimeout(() => {\n      this._cachedTemplates = null;\n    }, this._cacheTtlMs);\n\n    return templates;\n  }\n\n  private async _fetchContentTemplates(\n    pageToken?: string\n  ): Promise<[ContentTemplate[], string?]> {\n    const contentTemplatesUrl = \"Client/v2/ContentTemplates\";\n    const url = new UriBuilder(contentTemplatesUrl);\n\n    url.arg(\"PageSize\", this._pageSize);\n\n    if (pageToken !== undefined) {\n      url.arg(\"PageToken\", pageToken);\n    }\n\n    const response = await this._services.commandExecutor.fetchResource<\n      void,\n      ContentTemplatesResponse\n    >(url.build());\n\n    return [\n      response.templates.map((template) => new ContentTemplate(template)),\n      response.meta.next_token,\n    ];\n  }\n}\n\nexport { ContentClient };\n"],"names":["UriBuilder","ContentTemplate"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AASA,MAAM,aAAa,CAAA;AAGjB,IAAA,WAAA,CACmB,SAAgC,EAChC,SAAA,GAAoB,GAAG,EACvB,cAAsB,IAAK,EAAA;QAF3B,IAAS,CAAA,SAAA,GAAT,SAAS,CAAuB;QAChC,IAAS,CAAA,SAAA,GAAT,SAAS,CAAc;QACvB,IAAW,CAAA,WAAA,GAAX,WAAW,CAAgB;QALtC,IAAgB,CAAA,gBAAA,GAAuC,IAAI,CAAC;KAMhE;AAEG,IAAA,MAAM,mBAAmB,GAAA;AAC9B,QAAA,IAAI,IAAI,CAAC,gBAAgB,KAAK,IAAI,EAAE;YAClC,OAAO,IAAI,CAAC,gBAAgB,CAAC;AAC9B,SAAA;QAED,IAAI,CAAC,aAAa,EAAE,SAAS,CAAC,GAAG,MAAM,IAAI,CAAC,sBAAsB,EAAE,CAAC;QACrE,IAAI,SAAS,GAAG,aAAa,CAAC;QAE9B,OAAO,SAAS,KAAK,IAAI,EAAE;AACzB,YAAA,CAAC,aAAa,EAAE,SAAS,CAAC,GAAG,MAAM,IAAI,CAAC,sBAAsB,CAAC,SAAS,CAAC,CAAC;YAC1E,SAAS,GAAG,CAAC,GAAG,SAAS,EAAE,GAAG,aAAa,CAAC,CAAC;AAC9C,SAAA;QAED,IAAI,CAAC,gBAAgB,GAAG,MAAM,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;QAEjD,UAAU,CAAC,MAAK;AACd,YAAA,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC;AAC/B,SAAC,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;AAErB,QAAA,OAAO,SAAS,CAAC;KAClB;IAEO,MAAM,sBAAsB,CAClC,SAAkB,EAAA;QAElB,MAAM,mBAAmB,GAAG,4BAA4B,CAAC;AACzD,QAAA,MAAM,GAAG,GAAG,IAAIA,gBAAU,CAAC,mBAAmB,CAAC,CAAC;QAEhD,GAAG,CAAC,GAAG,CAAC,UAAU,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;QAEpC,IAAI,SAAS,KAAK,SAAS,EAAE;AAC3B,YAAA,GAAG,CAAC,GAAG,CAAC,WAAW,EAAE,SAAS,CAAC,CAAC;AACjC,SAAA;AAED,QAAA,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,aAAa,CAGjE,GAAG,CAAC,KAAK,EAAE,CAAC,CAAC;QAEf,OAAO;AACL,YAAA,QAAQ,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,QAAQ,KAAK,IAAIC,+BAAe,CAAC,QAAQ,CAAC,CAAC;YACnE,QAAQ,CAAC,IAAI,CAAC,UAAU;SACzB,CAAC;KACH;AACF;;;;"}